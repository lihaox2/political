<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bayee.political.mapper.ScoringRulesMapper" >
  <resultMap id="BaseResultMap" type="com.bayee.political.domain.ScoringRules" >
    <id column="id" property="id" />
    <result column="scored_police_id" property="scoredPoliceId" />
    <result column="department_id" property="departmentId" />
    <result column="violations_id" property="violationsId" />
    <result column="violations_details" property="violationsDetails" />
    <result column="scoring_clause_id" property="scoringClauseId" />
    <result column="score_deduct" property="scoreDeduct" />
    <result column="scoring_police_id" property="scoringPoliceId" />
    <result column="scoring_date" property="scoringDate" />
    <result column="creation_date" property="creationDate" />
    <result column="update_date" property="updateDate" />
    
    <result column="scored_name" property="scoredName" />
    <result column="scoring_name" property="scoringName" />
    <result column="department_name" property="departmentName" />
    <result column="violations_content" property="violationsContent" />
    <result column="scoring_clause_content" property="scoringClauseContent" />
    
  </resultMap>
  
  <select id="getScoringRules" resultMap="BaseResultMap">
  select a.*,b.name as scored_name,c.`name` as scoring_name,d.`name` as department_name,e.content as violations_content,
f.content as scoring_clause_content 
from scoring_rules a 
left join `user` b on a.scored_police_id = b.police_id 
left join `user` c on a.scoring_police_id = c.police_id 
left join department d on a.department_id = d.id 
left join violations e on a.violations_id = e.id 
left join scoring_clause f on a.scoring_clause_id = f.id 
where 1 = 1 
<if test="departmentId!=null and departmentId!=''">
and a.department_id = #{departmentId} 
</if> 
<if test="scoringDate!=null and scoringDate!=''">
and a.scoring_date = #{scoringDate} 
</if>
<if test="policeId!=null and policeId!=''">
and (b.police_id = #{policeId} or c.police_id = #{policeId}) 
</if> 
<if test="name!=null and name!=''">
and (b.`name` = #{name} or c.`name` = #{name}) 
</if> 
<if test="phone!=null and phone!=''">
and (b.phone = #{phone} or c.phone = #{phone}) 
</if> 
<if test="idCard!=null and idCard!=''">
and (b.id_card = #{idCard} or c.id_card = #{idCard}) 
</if> 
limit #{pageSize},10 
</select>
  
  <insert id="addScoringRules">
  insert into scoring_rules(scored_police_id,department_id,violations_id,violations_details,
  scoring_clause_id,score_deduct,scoring_police_id,scoring_date,creation_date,update_date) 
  values(#{scoringRules.scoredPoliceId},#{scoringRules.departmentId},#{scoringRules.violationsId},#{scoringRules.violationsDetails},#{scoringRules.scoringClauseId},
  #{scoringRules.scoreDeduct},#{scoringRules.scoringPoliceId},#{scoringRules.scoringDate},now(),now());
  </insert>
  
  <update id="updateScoringRules">
  update scoring_rules 
	set scored_police_id = #{scoringRules.scoredPoliceId},
	violations_id = #{scoringRules.violationsId},
	violations_details = #{scoringRules.violationsDetails},
	scoring_clause_id = #{scoringRules.scoringClauseId},
	score_deduct = #{scoringRules.scoreDeduct},
	scoring_police_id = #{scoringRules.scoringPoliceId},
	scoring_date = #{scoringRules.scoringDate} 
	where id = #{scoringRules.id}
  </update>
  
  <delete id="deleteScoringRulesById">
  	delete from scoring_rules where id = #{id}
  </delete>
  
  <select id="getScoringRulesById" resultMap="BaseResultMap">
    select a.*,b.name as scored_name,c.`name` as scoring_name,d.`name` as department_name,e.content as violations_content,
f.content as scoring_clause_content 
from scoring_rules a 
left join `user` b on a.scored_police_id = b.police_id 
left join `user` c on a.scoring_police_id = c.police_id 
left join department d on a.department_id = d.id 
left join violations e on a.violations_id = e.id 
left join scoring_clause f on a.scoring_clause_id = f.id 
where a.id = #{id}
  </select>
  
  </mapper>